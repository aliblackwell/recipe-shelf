---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

const recipes = await getCollection("recipes");

const byCategory = recipes.reduce(
  (acc, recipe) => {
    const key = recipe.data.category;
    if (!acc[key]) acc[key] = [];
    acc[key].push(recipe);
    return acc;
  },
  {} as Record<string, typeof recipes>
);

const categoryOrder = ["Breads", "Meals", "Prep", "Base recipes"];
const staples = [
  "Flax seed",
  "Nuts",
  "Muesli",
  "Blueberries",
  "Bananas",
  "Olive oil",
];
const equipment = ["Spiraliser", "Food processor", "Air fryer", "Cloche"];
---

<Layout title="Alasdair's Well-Fed Kitchen" description="Local-first recipes hosted on Raspberry Pi at blackwellfed.com.">
  <header class="site-header">
    <div>
      <h1 class="site-title">Alasdair's Well-Fed Kitchen</h1>

      <blockquote class="hero-quote">
        "I've had an elegant sufficiency; anything else would be flippety-floppety"
      </blockquote>
    </div>
    <span class="tagline">{recipes.length} recipes</span>
  </header>

  {
    categoryOrder.map((category) => {
      const items = byCategory[category] ?? [];
      if (!items.length) return null;

      return (
        <section class="section">
          <h2>{category}</h2>
          <div class="grid cols-3">
            {items
              .sort((a, b) => a.data.title.localeCompare(b.data.title))
              .map((recipe) => (
                <a class="card" href={`/recipes/${recipe.slug}/`}>
                  <h3>{recipe.data.title}</h3>
                  <p>{recipe.data.summary ?? "Open recipe"}</p>
                </a>
              ))}
          </div>
        </section>
      );
    })
  }

  <section class="section">
    <h2>Staples</h2>
    <div class="recipe-meta">
      {staples.map((item) => <span>{item}</span>)}
    </div>
  </section>

  <section class="section">
    <h2>Equipment</h2>
    <div class="recipe-meta">
      {equipment.map((item) => <span>{item}</span>)}
    </div>
  </section>

  <p class="footer-note">Running locally first, ready to extend anytime.</p>
</Layout>
